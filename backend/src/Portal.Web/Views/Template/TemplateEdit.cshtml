@using Portal.Core.Emails.Templates.Models;
@using Portal.Core.Users;
@using Portal.Web.Models.Users;

@model TemplateModel
@{
  Layout = "_Layout";

  ViewBag.Title = Model?.DisplayName ?? Model?.Key ?? "Create template";
}

@functions {
  private UserSummary UserSummary
  {
    get
    {
      User? user = Context.GetUser();

      return new UserSummary
      {
        IsAuthenticated = user != null,
        Email = user?.Email,
        FullName = user?.FullName,
        Picture = user?.Picture,
        Username = user?.Username
      };
    }
  }
}

@if (Model == null)
{
  <template-edit realm="@(Context.Request.Query["realm"])"></template-edit>
}
else
{
  <template-edit json="@(ModelSerializer.Serialize(Model))" status="@(Context.Request.Query["status"])" user="@(ModelSerializer.Serialize(UserSummary))"></template-edit>
}
