@using Logitar.Portal.Contracts.Senders;
@using Logitar.Portal.Contracts.Templates;
@using Logitar.Portal.Core.Senders;

@inject ISenderQuerier _senderQuerier;

@model Template
@{
  Layout = "_Layout";

  ViewBag.Title = Model?.DisplayName ?? Model?.Key ?? "Create template";

  string? sender = null;
  if (Model != null)
  {
    Sender? defaultSender;
    if (Model.Realm == null)
    {
      defaultSender = await _senderQuerier.GetDefaultAsync(realm: null);
    }
    else
    {
      defaultSender = await _senderQuerier.GetDefaultAsync(Model.Realm.Id.ToString());
    }
    sender = ModelSerializer.Serialize(defaultSender);
  }
}

@if (Model == null)
{
  <template-edit realm="@(Context.Request.Query["realm"])"></template-edit>
}
else
{
  <template-edit json="@(ModelSerializer.Serialize(Model))" sender="@(sender)" status="@(Context.Request.Query["status"])" user="@(ModelSerializer.Serialize(Context.GetCurrentUser()))"></template-edit>
}
